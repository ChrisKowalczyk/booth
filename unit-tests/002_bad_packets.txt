# vim: ft=sh et :
#
# This test is mostly concerned with ignoring invalid packets.
# We're expecting catchup queries.


ticket:
    state               ST_INIT
    last_ack_ballot     1
    new_ballot          12


# defaults
message:
    header.cmd          CMR_CATCHUP
    ticket.ballot       99
    ticket.prev_ballot  98
    header.from         booth_conf->site[2].site_id
    header.result       0


message0:               # bad result code
    header.result       243521741

outgoing0:
    state               ST_INIT


message1:               # bad sender
    header.from         71

outgoing1:
    state               ST_INIT



message2:               # bad version
    header.version      512

outgoing2:
    state               ST_INIT


message3:               # bad magic
    header.version      31

outgoing3:
    state               ST_INIT

message4:               # bad length
    header.length       16

outgoing4:
    state               ST_INIT


message5:               # bad ticket ID
    ticket.id           "gibtsnich"

outgoing5:
    state               ST_INIT


message6:               # bad ballot number
    ticket.ballot       -15

outgoing6:
    state               ST_INIT


message100:             # should work
    ticket.ballot       199
    ticket.prev_ballot  198

# no outgoing message
finally:                
    state               ST_STABLE
    new_ballot          199
    last_ack_ballot     198

