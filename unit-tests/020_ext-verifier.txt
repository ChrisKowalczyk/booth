# vim: ft=sh et :
#
# Testing whether the external verifier (before-acquire-handler)
# is obeyed.


ticket:
    state               ST_STABLE
    last_ack_ballot     40
    new_ballot          50
    owner               local
    retries             6
    timeout             1
    # may keep ticket all the time
    expiry              3000
    # but shall start renewal now
    expires             time(0) + 1000



outgoing0:
    header.cmd          OP_PREPARING

# now say that we may not have it anymore.

ticket1:
    ext_verifier        "/bin/false"
    # cause re-query of the verifier
    state               ST_STABLE

gdb1:
    break ticket_broadcast_proposed_state ยง commands ยง bt ยง c ยง end

# We just tell the others we don't have it anymore.
outgoing2:
    header.cmd          OP_COMMITTED
    ticket.owner        -1

finally:
    state        ST_STABLE
    owner        NULL
